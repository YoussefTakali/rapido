<div class="calendar-container">
  <!-- Header -->
  <div class="calendar-header">
    <div class="header-left">
      <div class="calendar-navigation">
        <button class="nav-button" (click)="previousWeek()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
        </button>

        <button class="today-button" (click)="setToday()">
          <span>Today</span>
        </button>

        <button class="nav-button" (click)="nextWeek()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9,18 15,12 9,6"></polyline>
          </svg>
        </button>
      </div>

      <div class="current-date">
        <h2 class="month-year">{{ getCurrentMonthYear() }}</h2>
        <p class="date-range">{{ getWeekDateRange() }}</p>
      </div>
    </div>

    <div class="header-center">
      <div class="view-selector">
        <button
          *ngFor="let viewOption of [CalendarView.Day, CalendarView.Week, CalendarView.Month]"
          class="view-button"
          [class.active]="view === viewOption"
          (click)="setView(viewOption)">
          {{ viewOption }}
        </button>
      </div>
    </div>

    <div class="header-right">
      <div class="search-container">
        <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input type="text" placeholder="Search events..." class="search-input" />
      </div>

      <div class="timezone-container">
        <div class="timezone">
          <span class="tz-name">{{ getCurrentTimeZone() }}</span>
          <small class="tz-offset">{{ getCurrentGMTOffset() }}</small>
        </div>
      </div>

      <button class="add-event-button" (click)="addEvent()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        <span>Add Event</span>
      </button>
    </div>
  </div>

  <!-- Week View Calendar -->
  <div class="calendar-grid" *ngIf="view === CalendarView.Week">
    <!-- Days Header -->
    <div class="days-header">
      <div class="time-column-header">
        <div class="time-zone-label">{{ getCurrentTimeZone() }}</div>
      </div>
      <div class="day-header" *ngFor="let day of weekDays; let i = index" [class.today]="day.isToday">
        <div class="day-name">{{ day.name }}</div>
        <div class="day-date" [class.today-date]="day.isToday">
          <span class="date-number">{{ day.date }}</span>
          <div class="today-indicator" *ngIf="day.isToday"></div>
        </div>
      </div>
    </div>

    <!-- Time Grid -->
    <div class="time-grid">
      <!-- Time Column -->
      <div class="time-column">
        <div class="time-slot" *ngFor="let time of timeSlots; let i = index" [class.current-hour]="isCurrentHour(time)">
          <span class="time-label">{{ time }}</span>
          <div class="current-time-indicator" *ngIf="isCurrentHour(time)"></div>
        </div>
      </div>

      <!-- Days Columns -->
      <div class="days-container">
        <div class="day-column" *ngFor="let day of weekDays; let dayIndex = index" [class.today-column]="day.isToday">
          <!-- Time slots background -->
          <div
            class="time-slot-bg"
            *ngFor="let time of timeSlots; let i = index"
            [class.current-hour-bg]="isCurrentHour(time)"
            [class.business-hours]="isBusinessHour(time)">
          </div>

          <!-- Current time line -->
          <div class="current-time-line" *ngIf="day.isToday" [style.top.px]="getCurrentTimePosition()"></div>

          <!-- Events -->
          <div class="event-container">
  <div
    class="event"
    *ngFor="let event of getEventsForDay(dayIndex)"
    [class]="'event-' + event.color"
    [style.top.px]="timeToPosition(event.time)"
    [style.height.px]="(event.duration || 1) * 60"
    (click)="selectEvent(event)"
    [class.selected]="selectedEvent === event"
  >
    <div class="event-content">
      <div class="event-time">{{ event.time }}</div>
      <div class="event-title">{{ event.title }}</div>
      <div class="event-description" *ngIf="event.description">{{ event.description }}</div>
      <!-- Attendees section removed -->
    </div>
    <div class="event-resize-handle"></div>
  </div>
</div>

        </div>
      </div>
    </div>
  </div>

  <!-- Other Views Placeholder -->
  <div *ngIf="view !== CalendarView.Week" class="view-placeholder">
    <div class="placeholder-content">
      <div class="placeholder-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
      </div>
      <h3>{{ view }} View</h3>
      <p>{{ view }} view implementation coming soon</p>
      <button class="back-to-week" (click)="setView(CalendarView.Week)">Back to Week View</button>
    </div>
  </div>
</div>
<!-- Add Event Button -->
<button (click)="addEvent()">Add Event</button>

<!-- Add Event Popup Modal -->
<div class="modal-backdrop" *ngIf="showAddEventPopup" (click)="closeAddEventPopup()"></div>
<div class="modal" *ngIf="showAddEventPopup">
  <h2>Add New Event</h2>
  <form [formGroup]="addEventForm" (ngSubmit)="submitAddEvent()">

    <label>
      Title*:
      <input formControlName="title" required />
    </label>

    <label>
      Description:
      <textarea formControlName="description"></textarea>
    </label>

    <label>
      Location:
      <input formControlName="location" />
    </label>

    <label>
      Start Date & Time*:
      <input type="datetime-local" formControlName="startDateTime" required />
    </label>

    <label>
      End Date & Time*:
      <input type="datetime-local" formControlName="endDateTime" required />
    </label>

    <label>
      All Day:
      <input type="checkbox" formControlName="isAllDay" />
    </label>

    <label>
      Recurrence:
      <select formControlName="recurrence">
        <option value="NONE">None</option>
        <option value="DAILY">Daily</option>
        <option value="WEEKLY">Weekly</option>
        <option value="MONTHLY">Monthly</option>
      </select>
    </label>

    <label>
      Reminder (minutes):
      <input type="number" formControlName="reminderMinutes" min="0" />
    </label>

    <label>
      Status:
      <select formControlName="status">
        <option value="SCHEDULED">Scheduled</option>
        <option value="CANCELLED">Cancelled</option>
        <option value="COMPLETED">Completed</option>
      </select>
    </label>

    <div class="buttons">
      <button type="submit" [disabled]="addEventForm.invalid">Submit</button>
      <button type="button" (click)="closeAddEventPopup()">Cancel</button>
    </div>

  </form>
</div>
